
### [Performance-Critical Knobs (for MySQL)](https://www.percona.com/blog/2020/06/30/mysql-101-parameters-to-tune-for-mysql-performance/)

Note *M* denotes the manually selected knobs.

| Knob Name                       |    Selected by    |                                            Note                                            |     Global     | Dynamic |        Type         |         Default Value         | Minimum Value |    Maximum Value     | Tuning Experience                                                                                                                                                                                                                                                |
|:--------------------------------|:-----------------:|:------------------------------------------------------------------------------------------:|:--------------:|:-------:|:-------------------:|:-----------------------------:|:-------------:|:--------------------:|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| innodb_buffer_pool_size         | M;QTune;OtterTune | innodb_buffer_pool_size = N * innodb_buffer_pool_chunk_size * innodb_buffer_pool_instances |       ✅        |    ✅    |       Integer       |    134217728 bytes (128MB)    |    5242880    | 9223372036854775807  | 初始值设为整个RAM的50%-70%，最大值不能超过数据库的大小。当给buffer pool分配的大小大于1GB时，可以使用多个buffer pool，可通过设置innodb_buffer_pool_instances的大小设置buffer pool实例的个数，支持高并发                                                                                                                   |
| ~~innodb_log_file_size~~        |    M;OtterTune    |                                          8.0.30废弃                                          |       ✅        |    ❌    |       Integer       |           50331648            | 4194304 (4MB) | 18446744073709551615 | 通常被设为128M-2G，                                                                                                                                                                                                                                              |
| innodb_redo_log_capacity        |         M         |                  8.0.30后替代innodb_log_file_size和innodb_log_files_in_group)                  |       ✅        |    ✅    |       Integer       |           104857600           |    8388608    |     137438953472     | redo log files占磁盘空间的大小。如果innodb_redo_log_capacity的值被设置，则忽略innodb_log_files_in_group和innodb_log_file_size的设置，否则由innodb_log_files_in_group * innodb_log_file_size = innodb_redo_log_capacity计算旋钮大小。当这些旋钮都没有被设置时，使用默认值                                        |
| innodb_flush_log_at_trx_commit  |         M         |                                             -                                              |       ✅        |    ✅    | Enumeration (0，1，2) |               1               |       -       |          -           | 默认值为1，代表严格遵守ACID，日志在每次事务提交时被写入并刷新到磁盘。设置为 "0 "或 "2 "将提供更多的性能，但耐久性较差。                                                                                                                                                                                        |
| innodb_flush_method             |    M;OtterTune    |                                        8.0可以使用数值型指定                                        |       ✅        |    ❌    |       String        | Unix:fsync Windows:unbuffered |               |                      | 控制刷新数据到Innodb data files以及log files的方式，能够影响I/O throughput                                                                                                                                                                                                  | 
| innodb_file_per_table           |         M         |                                             -                                              |       ✅        |    ✅    |       Boolean       |              NO               |               |                      |                                                                                                                                                                                                                                                            |
| innodb_stats_on_metadata        |         M         |               SET GLOBAL innodb_stats_on_metadata=mode (mode = ON/OFF; 1/0;)               |       ✅        |    ✅    |       Boolean       |              OFF              |               |                      | 禁用这个设置可以提高有大量表或索引的模式的访问速度。它还可以提高涉及InnoDB表的查询的执行计划的稳定性                                                                                                                                                                                                      |
| innodb_buffer_pool_instances    |    M;OtterTune    |                               innodb_buffer_pool_size >= 1GB                               |       ✅        |    ❌    |       Integer       |              分系统              |       1       |          64          |                                                                                                                                                                                                                                                            |
| ~~~query_cache_type~~~          |         M         |                                  Removed in MySQL 8.0.3.                                   |                |         |                     |                               |               |                      |                                                                                                                                                                                                                                                            |
| ~~~query_cache_size~~~          |         M         |                                  Removed in MySQL 8.0.3.                                   |                |         |                     |                               |               |                      |                                                                                                                                                                                                                                                            |
| ~~~query_cache_limit~~~         |         M         |                                  Removed in MySQL 8.0.3.                                   |                |         |                     |                               |               |                      |                                                                                                                                                                                                                                                            |
| innodb_autoinc_lock_mode        |         M         |                          用于生成自动增量值的锁定模式。允许的值是0、1或2，分别代表传统、连续或交错。                           |       ✅        |    ❌    |       Integer       |               2               |               |                      | 0,1,2 for traditional, consecutive, or interleaved                                                                                                                                                                                                         |
| innodb_io_capacity              |         M         |                                                                                            |       ✅        |    ✅    |       Integer       |              200              |      100      |          ?           | 定义了InnoDB后台任务可用的每秒I/O操作数（IOPS）                                                                                                                                                                                                                             |
| innodb_io_capacity_max          |         M         |                                                                                            |       ✅        |    ✅    |       Integer       |                               |      100      |                      |                                                                                                                                                                                                                                                            |
| max_connections                 |      M;QTune      |                                                                                            |       ✅        |    ✅    |       Integer       |              151              |       1       |       	100000        |                                                                                                                                                                                                                                                            |
| table_open_cache                |       QTune       |                                                                                            |       ✅        |    ✅    |       Integer       |             4000              |       1       |        524288        | MAX( (open_files_limit - 10 - max_connections) / 2, 400)                                                                                                                                                                                                   |
| join_buffer_size                |       QTune       |                           在MySQL 8.0.18及以后的版本中，这个变量也控制用于哈希连接的内存                            | ✅<br/> Session |    ✅    |       Integer       |        262144 (256KB)         |      128      |                      | 用于普通索引扫描、范围索引扫描和不使用索引从而执行全表扫描的连接的缓冲区的最小尺寸。当不可能添加索引时，增加join_buffer_size的值以获得更快的全连接                                                                                                                                                                          |
| key_buffer_size                 |       QTune       |                     动态调整范围（0，max】且需要以4096 bytes的倍数增加或减少。仅在数据库重启时能被设置为0                     |       ✅        |    ✅    |       Integer       |            8388608            |       0       |                      | 用于索引块的缓冲区的大小，key buffer也被称为key cache                                                                                                                                                                                                                       |
| preload_buffer_size             |       QTune       |                                                                                            | ✅<br/> Session |    ✅    |       Integer       |             32768             |     1024      |      1073741824      | 预加载索引时分配的缓冲区的大小                                                                                                                                                                                                                                            |
| sort_buffer_size                |       QTune       |                 当SHOW GLOBAL STATUS显示每分钟的Sort_merge_passes较大时，可以考虑增加该变量的值                  | ✅<br/> Session |    ✅    |       Integer       |            262144             |     32768     |                      |                                                                                                                                                                                                                                                            |
| binlog_cache_size               |       QTune       |                                      block size 4096                                       |       ✅        |    ✅    |       Integer       |             32768             |     4096      |                      | 内存缓冲区的大小，用于保存交易期间对binary log的更改。                                                                                                                                                                                                                           |
| ~~~max_length_for_sort_data~~~  |       QTune       |                                          8.0.20废弃                                          |                |         |                     |                               |               |                      |                                                                                                                                                                                                                                                            |
| max_prepared_stmt_count         |       QTune       |                                          与预编译语句相关                                          |       ✅        |    ✅    |       Integer       |             16382             |       0       |       4194303        | 这个变量限制了服务器中prepared statements的总数                                                                                                                                                                                                                          |
| max_sp_recursion_depth          |       QTune       |                与thread_stack的大小有关，当增加该旋钮的值时，可能需要在startup阶段增加thread_stack的大小                | ✅<br/> Session |    ✅    |       Integer       |               0               |       0       |         255          | 任何给定的存储过程可以被递归调用的次数,存储过程递归会增加对线程堆栈空间的需求。如果你增加了max_sp_recursion_depth的值，可能有必要在服务器启动时通过增加thread_stack的值来增加线程栈的大小。                                                                                                                                            |
| max_user_connections            |       QTune       |                                                                                            | ✅<br/> Session |    ✅    |       Integer       |               0               |       0       |      4294967295      | 允许任何给定的MySQL用户账户同时连接的最大数量                                                                                                                                                                                                                                  |
| innodb_thread_sleep_delay       |     OtterTune     |             设置innodb_adaptive_max_sleep_delay的大小为该变量的上限，Innodb会根据当前的线程自动的调节该变量             |       ✅        |    ✅    |       Integer       |             10000             |       0       |       1000000        | InnoDB线程在加入InnoDB队列前的睡眠时间，单位是微秒,                                                                                                                                                                                                                           |
| innodb_thread_concurrency       |     OtterTune     |                                                                                            |       ✅        |    ✅    |       Integer       |               0               |       0       |         1000         | 定义了InnoDB内部允许的最大线程数。0的值（默认值）被解释为无限并发（无限制）。这个变量是为了在高并发系统上进行性能调整。                                                                                                                                                                                            |
| innodb_max_dirty_pages_pct_lwm  |     OtterTune     |                              大小应低于innodb_max_dirty_pages_pct值                              |       ✅        |    ✅    |       Numeric       |              10               |       0       |        99.99         | 定义一个代表脏页百分比的低水位线以控制脏页的比例                                                                                                                                                                                                                                   |
| innodb_read_ahead_threshold     |     OtterTune     |                                                                                            |       ✅        |    ✅    |       Integer       |              56               |       0       |          64          | 控制InnoDB用来预取页面到缓冲池的线性读前的灵敏度                                                                                                                                                                                                                                |
| innodb_adaptive_max_sleep_delay |     OtterTune     |                                innodb_thread_sleep_delay的上限                                |       ✅        |    ✅    |       Integer       |            150000             |       0       |       1000000        |                                                                                                                                                                                                                                                            |
| thread_cache_size               |     OtterTune     |                                                                                            |       ✅        |    ✅    |       Integer       |        -1 (autosizing)        |       0       |        16384         | 服务器应该缓存多少个线程以便重复使用,如果你的服务器每秒看到数百个连接，你通常应该把thread_cache_size设置得足够高，以便大多数新连接使用缓存的线程                                                                                                                                                                          |
| tmp_table_size                  |        PKU        |                                                                                            | ✅<br/> Session |    ✅    |       Integer       |           16777216            |     1024      | 18446744073709551615 | 定义由MEMORY存储引擎以及从MySQL 8.0.28开始的TempTable存储引擎创建的内部内存临时表的最大尺寸。如果一个内部内存临时表超过这个大小，它将自动转换为一个磁盘上的内部临时表。                                                                                                                                                          |
| max_heap_table_size             |        PKU        |                                                                                            | ✅<br/> Session |    ✅    |       Integer       |           16777216            |     16384     |                      | block size 1024 这个变量设置了允许用户创建的MEMORY表增长的最大尺寸。该变量的值被用来计算MEMORY表的MAX_ROWS值。                                                                                                                                                                                  |
| innodb_spin_wait_delay          |        PKU        |                                                                                            |       ✅        |    ✅    |       Integer       |               6               |       0       |         1000         | spin lock的最大延迟                                                                                                                                                                                                                                             |
| ~~~query_prealloc_size~~~       |        PKU        |                          从MySQL 8.0.29开始，query_prealloc_size已被废弃                           | ✅<br/> Session |    ✅    |       Integer       |             8192              |     8192      |                      |                                                                                                                                                                                                                                                            |
| innodb_doublewrite              |        PKU        |                                                                                            |       ✅        |    ✅    |     Enumeration     |              ON               |               |                      | 	ON OFF DETECT_AND_RECOVER DETECT_ONLY                                                                                                                                                                                                                     |
|                                 |                   |                                                                                            |                |         |                     |                               |               |                      |                                                                                                                                                                                                                                                            |
|                                 |                   |                                                                                            |                |         |                     |                               |               |                      |                                                                                                                                                                                                                                                            |






***(VM) Hardware relevant knobs***

**(1) innodb_buffer_pool_size**  
    ---innodb_buffer_pool_size = N * innodb_buffer_pool_chunk_size * innodb_buffer_pool_instances

**(2) innodb_log_file_size**  

**(3) innodb_flush_log_at_trx_commit** 

**(4) innodb_flush_method**

***Best Performance Practices***   

**(1) innodb_file_per_table**   

**(2) innodb_stats_on_metadata**

**(3) innodb_buffer_pool_instances**

**(4) query_cache_type & query_cache_size**

